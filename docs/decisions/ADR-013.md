# ADR-013: Protocol-First Architecture with Configurable Enforcement Depth

Date: 2026-02-11
Status: Accepted

## Context

The architecture was initially positioned around OS/kernel-level enforcement (AppArmor + nftables) as the primary value proposition. However, this limits the addressable deployment scenarios to environments where users control their own infrastructure. Cloud-native, SaaS, and containerized deployments can't use kernel enforcement.

Meanwhile, the governance protocol (classify → submit → execute → report), the deterministic Arbiter, and the audit chain work at any deployment layer. The kernel enforcement is the strongest backend — but it's one backend, not the only option.

## Decision

The product is the governance protocol and deterministic decision engine. OS-level enforcement is the premium enforcement backend, not the defining feature.

Architecture supports three enforcement tiers:

1. **Kernel** (strongest) — AppArmor + nftables + signed tokens verified by OS. For on-prem, self-hosted, security-critical deployments.
2. **Container** (strong) — seccomp profiles, network policies, eBPF. For cloud/Kubernetes deployments.
3. **Application** (baseline) — process isolation, API key scoping, framework-level hooks. For SaaS and environments without OS access. Still provides: deterministic policy, separation of duties, token-gated execution, audit chain.

All three tiers use the same governance API (specs/governance-api.yaml), the same Arbiter, and the same audit format.

## Rationale

1. **Deployment flexibility.** Kernel-only limits deployment to self-hosted infrastructure. Protocol-first reaches all environments, with kernel as the strongest enforcement option.
2. **Defense in depth is the correct framing.** Even application-level governance with deterministic policy + audit is better than no governance. The kernel adds strength, it doesn't create the value.
3. **Analogy: HTTPS.** The protocol works everywhere. Hardware-backed certificate verification (HSM/TPM) is the strongest deployment. Nobody limits HTTPS to HSM users.

## Consequences

- Positioning shifts from "OS-level enforcement" to "deterministic governance protocol with configurable enforcement depth"
- OpenAPI spec becomes the primary artifact, not AppArmor profiles
- Kernel enforcement becomes a documented "maximum security" deployment option
- Application-level enforcement needs design work (Phase 2-3) — how does token verification work without kernel support?
